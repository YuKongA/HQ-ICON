export default function drawOutline(data, cut, resolution, format) {
    return new Promise((resolve) => {
        const { artworkUrl512, kind } = data;
        const canvas = document.createElement('canvas');
        canvas.width = resolution;
        canvas.height = resolution;
        const ctx = canvas.getContext('2d');
        const appIcon = new Image();
        appIcon.setAttribute('crossOrigin', 'anonymous');
        
        // Handle Google Play icons differently - they don't have size variants
        if (kind === 'googlePlaySoftware') {
            appIcon.src = artworkUrl512;
        } else {
            const iOSDefaultUrl = '/512x512bb.jpg';
            const macDefaultUrl = '/512x512bb.png';
            const newUrl = `/${resolution}x${resolution}bb.webp`;
            appIcon.src = artworkUrl512.replace(iOSDefaultUrl, newUrl).replace(macDefaultUrl, newUrl);
        }
        appIcon.onload = function () {
            ctx.drawImage(appIcon, 0, 0);
            ctx.globalCompositeOperation = 'destination-in';
            const drawOutline = (outlinePath) => {
                const outline = new Path2D(outlinePath);
                ctx.fill(outline);
            }
            if (kind === 'googlePlaySoftware') {
                // Google Play icons are already in the correct format, just draw as-is
                drawOutline(`m${resolution}, m${resolution}`);
            } else if (kind.startsWith('software')) {
                if (cut === '1') {
                    if (resolution === '256') {
                        drawOutline('m256,175.92c0,3.06,0,6.12-.02,9.17-.01,2.58-.04,5.16-.11,7.73-.07,5.64-.57,11.26-1.48,16.82-.95,5.57-2.73,10.96-5.27,15.99-5.16,10.12-13.38,18.35-23.5,23.51-5.04,2.54-10.42,4.32-15.98,5.27-5.57.92-11.19,1.42-16.82,1.48-2.58.07-5.15.1-7.73.12-3.06.02-6.12.02-9.17.02h-95.85c-3.06,0-6.11,0-9.17-.01-2.58,0-5.15-.04-7.73-.11-5.64-.07-11.26-.57-16.82-1.49-5.56-.95-10.95-2.73-15.98-5.27-10.12-5.16-18.35-13.38-23.5-23.5-2.55-5.04-4.32-10.43-5.27-16-.92-5.56-1.41-11.18-1.48-16.81-.07-2.58-.1-5.16-.11-7.73-.02-3.06-.02-6.11-.02-9.17v-95.84c0-3.06,0-6.12.02-9.19.01-2.57.05-5.15.11-7.72.07-5.63.57-11.25,1.48-16.81.95-5.57,2.73-10.96,5.27-16,5.16-10.12,13.38-18.35,23.5-23.51,5.04-2.54,10.42-4.32,15.97-5.27,5.57-.92,11.19-1.41,16.82-1.48,2.58-.07,5.16-.1,7.73-.11,3.06-.02,6.12-.02,9.17-.02h95.85c3.06,0,6.12,0,9.18.02,2.58.01,5.15.05,7.73.11,5.63.07,11.26.57,16.82,1.48,5.57.95,10.95,2.73,15.99,5.27,10.12,5.16,18.35,13.38,23.51,23.51,2.54,5.04,4.32,10.43,5.27,15.99.92,5.56,1.41,11.18,1.48,16.82.07,2.58.1,5.16.11,7.73.02,3.06.02,6.12.02,9.17v95.85h0Z');
                    } else if (resolution === '512') {
                        drawOutline('m512,351.84c0,6.12,0,12.23-.04,18.34-.03,5.15-.09,10.31-.22,15.45-.14,11.27-1.13,22.51-2.96,33.63-1.9,11.13-5.45,21.91-10.54,31.98-10.31,20.24-26.76,36.7-47,47.01-10.07,5.08-20.84,8.63-31.96,10.53-11.13,1.84-22.37,2.83-33.64,2.96-5.15.13-10.3.21-15.45.23-6.12.03-12.23.03-18.34.03h-191.69c-6.11,0-12.22,0-18.34-.03-5.15-.02-10.3-.09-15.45-.22-11.27-.14-22.51-1.14-33.64-2.97-11.12-1.89-21.89-5.45-31.96-10.53-20.24-10.31-36.69-26.76-47-46.99-5.09-10.08-8.64-20.86-10.54-31.99-1.83-11.11-2.82-22.35-2.96-33.62-.13-5.15-.2-10.31-.22-15.46-.04-6.12-.04-12.22-.04-18.34v-191.67c0-6.12,0-12.24.04-18.37.02-5.14.09-10.3.22-15.44.14-11.26,1.13-22.5,2.96-33.62,1.9-11.13,5.45-21.91,10.54-31.99,10.31-20.24,26.76-36.7,47-47.01,10.07-5.08,20.83-8.63,31.94-10.53,11.13-1.83,22.37-2.82,33.64-2.96,5.15-.13,10.31-.2,15.45-.22,6.12-.03,12.24-.03,18.34-.03h191.69c6.12,0,12.24,0,18.35.03,5.15.02,10.3.09,15.45.22,11.26.14,22.51,1.14,33.63,2.96,11.13,1.9,21.89,5.45,31.97,10.53,20.24,10.31,36.7,26.76,47.01,47.01,5.08,10.08,8.63,20.86,10.53,31.98,1.83,11.12,2.82,22.36,2.96,33.63.13,5.15.2,10.31.22,15.45.04,6.12.04,12.23.04,18.34v191.69h0Z');
                    } else if (resolution === '1024') {
                        drawOutline('m1024,703.67c0,12.24,0,24.46-.08,36.68-.06,10.3-.18,20.62-.44,30.9-.28,22.54-2.26,45.02-5.92,67.26-3.8,22.26-10.9,43.82-21.08,63.96-20.62,40.48-53.52,73.4-94,94.02-20.14,10.16-41.68,17.26-63.92,21.06-22.26,3.68-44.74,5.66-67.28,5.92-10.3.26-20.6.42-30.9.46-12.24.06-24.46.06-36.68.06h-383.39c-12.22,0-24.44,0-36.68-.06-10.3-.04-20.6-.18-30.9-.44-22.54-.28-45.02-2.28-67.28-5.94-22.24-3.78-43.78-10.9-63.92-21.06-40.48-20.62-73.38-53.52-94-93.98-10.18-20.16-17.28-41.72-21.08-63.98-3.66-22.22-5.64-44.7-5.92-67.24-.26-10.3-.4-20.62-.44-30.92-.08-12.24-.08-24.44-.08-36.68v-383.35c0-12.24,0-24.48.08-36.74.04-10.28.18-20.6.44-30.88.28-22.52,2.26-45,5.92-67.24,3.8-22.26,10.9-43.82,21.08-63.98,20.62-40.48,53.52-73.4,94-94.02,20.14-10.16,41.66-17.26,63.88-21.06,22.26-3.66,44.74-5.64,67.28-5.92,10.3-.26,20.62-.4,30.9-.44,12.24-.06,24.48-.06,36.68-.06h383.39c12.24,0,24.48,0,36.7.06,10.3.04,20.6.18,30.9.44,22.52.28,45.02,2.28,67.26,5.92,22.26,3.8,43.78,10.9,63.94,21.06,40.48,20.62,73.4,53.52,94.02,94.02,10.16,20.16,17.26,41.72,21.06,63.96,3.66,22.24,5.64,44.72,5.92,67.26.26,10.3.4,20.62.44,30.9.08,12.24.08,24.46.08,36.68v383.39l.02-.02Z');
                    }
                }
            } else {
                drawOutline(`m${resolution}, m${resolution}`);
            }
            resolve(canvas.toDataURL(`image/${format}`));
        };
    });
}
